{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="px-4 py-12">
    <div class="container mx-auto max-w-6xl">
        <header class="mb-12">
            <div class="flex items-start justify-between">
                <!-- Dropdown Import Menu -->
                <div class="relative order-2">
                    <button id="import-menu-btn" class="w-10 h-10 rounded-lg border border-[var(--border-color)] bg-[var(--bg-primary)] text-[var(--text-primary)] flex items-center justify-center hover:border-[var(--brand-mint)] transition-colors shadow-sm">
                        <i class="fas fa-bars text-base"></i>
                    </button>
                    <div id="import-menu" class="hidden absolute mt-2 w-64 bg-[var(--bg-primary)] border border-[var(--border-color)] rounded-xl shadow-lg z-10">
                        <div class="py-2">
                            <a href="{% url 'core:canva_login' %}" class="flex items-center gap-3 px-4 py-2 hover:bg-[var(--bg-tertiary)] transition-colors">
                                <img src="{% static 'img/canva_logo_icon_168460.svg' %}" alt="Canva" class="w-5 h-5" />
                                <span class="text-[var(--text-primary)] font-medium">Importar de Canva</span>
                            </a>
                            <a href="#" class="flex items-center gap-3 px-4 py-2 hover:bg-[var(--bg-tertiary)] transition-colors">
                                <i class="fab fa-google-drive text-blue-500"></i>
                                <span class="text-[var(--text-primary)] font-medium">Importar de Google Drive</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Title aligned to left -->
                <div class="text-left order-1 flex-1">
                    <h1 class="text-6xl font-black mb-1 canva-text tracking-tighter">Tus Presentaciones</h1>
                    <p class="text-[var(--text-secondary)] text-sm font-medium">Gestiona y presenta tus diapositivas con el poder de <b>GESVAS</b></p>
                </div>
            </div>
        </header>

        
        <!-- Subidas localmente -->
        <div class="mb-6 flex items-center gap-3">
            <h2 class="text-2xl font-black text-[var(--text-primary)] tracking-tight">Subidas</h2>
            <div class="h-px flex-1 bg-[var(--border-color)]"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- DB Presentations -->
            {% for item in db_presentations %}
            <div class="relative group">
                <a href="{% url 'core:presentation' item.local_id %}" class="block">
                    <div class="card-clean neon-border-hover relative">
                        <div class="overflow-hidden rounded-2xl">
                            <!-- Image Container -->
                            <div class="h-48 bg-[var(--bg-tertiary)] overflow-hidden relative">
                                {% if item.thumbnail %}
                                <img src="{{ item.thumbnail.url }}" alt="{{ item.title }}"
                                    class="w-full h-full object-cover transition-all duration-500 group-hover:scale-110 group-hover:brightness-110">
                                {% else %}
                                <div
                                    class="w-full h-full flex flex-col items-center justify-center bg-[var(--bg-primary)] overflow-hidden relative border border-[var(--border-color)]">
                                    <i class="fas fa-circle-notch fa-spin text-4xl text-[var(--brand-mint)] mb-3"></i>
                                    <span
                                        class="text-xs font-bold uppercase tracking-widest text-[var(--brand-mint)] animate-pulse">Procesando
                                        Diseño...</span>
                                    <!-- Small neon loader bar -->
                                    <div
                                        class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-transparent via-[var(--brand-mint)] to-transparent w-full animate-[shimmer_2s_infinite]">
                                    </div>
                                </div>
                                {% endif %}
                                <!-- Gradient Overlay on Hover -->
                                <div
                                    class="absolute inset-0 bg-gradient-to-br from-purple-500/20 via-blue-500/20 to-cyan-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                                </div>
                                <!-- Play Button -->
                                <div
                                    class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
                                    <div
                                        class="bg-[var(--bg-primary)] text-[var(--text-primary)] font-bold px-8 py-3 rounded-full shadow-2xl flex items-center space-x-3 transform scale-90 group-hover:scale-100 transition-transform duration-300 border border-[var(--border-color)]">
                                        <i class="fas fa-play text-sm text-[var(--brand-mint)]"></i>
                                        <span>Presentar</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="p-5">
                                <h3
                                    class="font-bold text-xl mb-2 text-[var(--text-primary)] group-hover:gradient-text transition-all duration-300">
                                    {{ item.title }}
                                </h3>
                                <p class="text-[var(--text-secondary)] text-sm flex items-center space-x-2">
                                    <i class="fas fa-file-powerpoint"></i>
                                    <span>Cargado: {{ item.created_at|date:"d M, Y" }}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </a>

                <!-- Delete Button (Outside the <a> to keep HTML valid) -->
                <form action="{% url 'core:delete_presentation' item.id %}" method="POST"
                    class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-50">
                    {% csrf_token %}
                    <button type="submit" onclick="return confirm('¿Estás seguro de eliminar esta presentación?')"
                        class="w-10 h-10 rounded-full bg-red-500/80 backdrop-blur-md text-white flex items-center justify-center hover:bg-red-600 transition-all hover:scale-110 shadow-xl">
                        <i class="fas fa-trash-alt text-sm"></i>
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>

        <!-- Importadas -->
        <div class="mb-6 flex items-center gap-3">
            <h2 class="text-2xl font-black text-[var(--text-primary)] tracking-tight">Importadas</h2>
            <div class="h-px flex-1 bg-[var(--border-color)]"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for design in canva_designs %}
            <a href="{% url 'core:presentation' design.id %}" class="block group">
                <div class="card-clean neon-border-hover relative">
                    <div class="overflow-hidden rounded-2xl">
                        <!-- Image Container -->
                        <div class="h-48 bg-[var(--bg-tertiary)] overflow-hidden relative">
                            <img src="{{ design.thumbnail }}" alt="{{ design.title }}"
                                class="w-full h-full object-cover transition-all duration-500 group-hover:scale-110 group-hover:brightness-110">
                            <!-- Gradient Overlay on Hover -->
                            <div
                                class="absolute inset-0 bg-gradient-to-br from-purple-500/20 via-blue-500/20 to-cyan-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                            </div>
                            <!-- Play Button -->
                            <div
                                class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300">
                                <div
                                    class="bg-[var(--bg-primary)] text-[var(--text-primary)] font-bold px-8 py-3 rounded-full shadow-2xl flex items-center space-x-3 transform scale-90 group-hover:scale-100 transition-transform duration-300 border border-[var(--border-color)]">
                                    <i class="fas fa-play text-sm text-[var(--brand-mint)]"></i>
                                    <span>Presentar</span>
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="p-5">
                            <h3
                                class="font-bold text-xl mb-2 text-[var(--text-primary)] group-hover:gradient-text transition-all duration-300">
                                {{ design.title }}
                            </h3>
                            <p class="text-[var(--text-secondary)] text-sm flex items-center space-x-2">
                                <i class="fas fa-file-powerpoint"></i>
                                <span>ID: {{ design.id }}</span>
                            </p>
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    (function() {
        const btn = document.getElementById('import-menu-btn');
        const menu = document.getElementById('import-menu');
        if (!btn || !menu) return;
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            menu.classList.toggle('hidden');
        });
        document.addEventListener('click', () => menu.classList.add('hidden'));
        menu.addEventListener('click', (e) => e.stopPropagation());
    })();
</script>
{% endblock %}